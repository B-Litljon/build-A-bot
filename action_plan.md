## Step-by-Step Integration Plan

Below is a checklist to "glue" the trading bot components together. Check off each task as you complete it.

---

- [ ] **Refine Data for Strategy Analysis in `TradingBot.handle_bar_update`**

    - When a `completed_bar` is generated by the `BarAggregator`, it's stored in `self.completed_agg_bars`.
    - The `RSIBBands.analyze` method expects a `Dict[str, pd.DataFrame]` where the key is the symbol and the value is a Pandas DataFrame of historical data.
    - **Action:**  
        - Inside the `if completed_bar:` block in `handle_bar_update`, uncomment and implement the `recent_bars_for_strategy` logic:
            - Retrieve the list of `completed_agg_bars` for the relevant `agg_interval`.
            - Convert this list of dictionaries (bars) into a Pandas DataFrame.
            - Ensure enough historical data is present before passing it to the strategy (e.g.,  
                ```python
                if len(recent_bars_for_strategy) < max(strategy.bb_period, strategy.rsi_period):
                        # Not enough data yet
                ```
                )

---

- [ ] **Call `strategy.analyze()` with Formatted Data**

    - **Action:**  
        - Once `recent_bars_for_strategy` (as a Pandas DataFrame) is ready, uncomment and use:
            ```python
            signals = self.strategy.analyze({self.symbol: recent_bars_for_strategy})
            ```
        - This will generate a list of `Signal` objects.

---

- [ ] **Pass Signals to `OrderManager.place_orders()`**

    - **Action:**  
        - After receiving the `signals` list from the strategy, uncomment and ensure this line is active:
            ```python
            self.place_orders(signals)
            ```
        - The `place_orders` method in `TradingBot` will iterate through these `Signal` objects and call `self.order_manager.place_order()`.

---

- [ ] **Integrate `OrderManager.monitor_orders()`**

    - The `OrderManager` has a `monitor_orders` method for managing open positions (stop-loss, take-profit, trailing stop).
    - **Action:**  
        - Decide where to call:
            ```python
            self.order_manager.monitor_orders(market_data)
            ```
        - A logical place is periodically within the main run loop of the `TradingBot`, or within `handle_bar_update` to monitor and adjust orders with each new bar.
        - Provide `market_data` containing the current price for symbols with active orders (possibly using the latest completed bars).

---

- [ ] **Refactor `strategy.py`**

    - Remove the duplicate `RSIBBands` class from `src/strategies/strategy.py`.
    - Only the abstract `Strategy` class should remain there.

---

- [ ] **Initial Historical Data for Aggregator**

    - The `BarAggregator` should handle cases where historical bars are requested first to get the bars started.
    - **Action:**  
        - Before connecting to the live stream, fetch enough historical 1-minute data (using your `AlpacaClient` and possibly `DataProcessor`).
        - Feed this data to the `BarAggregator` to populate its buffers and generate initial higher timeframe bars.
        - This ensures your strategy has sufficient lookback data from the start.

---

By following and checking off these steps, you'll connect the live data stream, bar aggregation, strategy analysis, and order management, bringing your trading bot closer to a functional state.